# 耐用年数自動算定機能 実装完了レポート

**作成日**: 2026年1月3日  
**コミットID**: 85d8ddf  
**デプロイ状態**: ✅ 完了

---

## 🎉 実装完了

不動産の**建築年月**、**取得年月日**、**構造**から、税法に基づいて耐用年数を自動算定する機能を実装しました。

---

## ✅ 実装内容

### 1. 耐用年数算定ロジック（Python）

**ファイル**: `app/utils/useful_life_calculator.py`

**機能**:
- 建築年月、取得年月日、構造から耐用年数を自動算定
- 新築/中古の判定
- 中古資産の簡便法による計算
- 法定耐用年数の全部/一部経過の判定

**法定耐用年数（構造別）**:
| 構造 | 耐用年数 |
|------|----------|
| RC造（鉄筋コンクリート造） | 47年 |
| 重量鉄骨造 | 34年 |
| 軽量鉄骨造（肉厚3mm超4mm以下） | 27年 |
| 軽量鉄骨造（肉厚3mm以下） | 19年 |
| 木造 | 22年 |

**算定ロジック**:

**新築の場合**（建築後1年未満）:
```
耐用年数 = 法定耐用年数
```

**中古の場合**（簡便法）:

法定耐用年数の全部を経過:
```
耐用年数 = 法定耐用年数 × 0.2（最低2年）
```

法定耐用年数の一部を経過:
```
耐用年数 = (法定耐用年数 - 経過年数) + 経過年数 × 0.2
```

### 2. 物件登録フォームに自動算定機能を追加

**ファイル**: `app/templates/property_property_new.html`

**変更内容**:
- 構造セレクトボックスを詳細な選択肢に変更（耐用年数を表示）
- 建築年月、取得年月日、構造フィールドに`onchange`イベントを追加
- JavaScriptで耐用年数を自動算定する関数を実装
- リアルタイム計算（入力時に即座に反映）

### 3. 物件編集フォームに自動算定機能を追加

**ファイル**: `app/templates/property_property_edit.html`

**変更内容**:
- 物件登録フォームと同様の機能を実装
- 既存データの読み込みと自動算定の両立

### 4. シミュレーション作成フォームに自動算定機能を追加

**ファイル**: `app/templates/property_simulation_new.html`

**変更内容**:
- 建築年月、取得年月日、構造の入力フィールドを追加
- 耐用年数算定結果を表示するアラートボックスを追加
- JavaScriptで耐用年数を自動算定し、建物_耐用年数フィールドに設定
- 減価償却費の自動計算と連携

---

## 🧪 テスト結果

### Pythonロジックのテスト

すべてのテストケースが成功しました：

| テストケース | 期待値 | 結果 |
|-------------|--------|------|
| 新築RC造マンション | 47年（新築） | ✅ 成功 |
| 築10年のRC造マンション | 39年（中古） | ✅ 成功 |
| 築50年のRC造マンション | 9年（中古） | ✅ 成功 |
| 築25年の木造アパート | 4年（中古） | ✅ 成功 |
| 築15年の重量鉄骨造マンション | 22年（中古） | ✅ 成功 |

### 本番環境での動作確認

**確認URL**: https://property-management-app-d46351d49159.herokuapp.com/property/properties/new

**確認項目**:
- ✅ 物件登録フォームが正常に表示
- ✅ 構造セレクトボックスに耐用年数が表示
- ✅ 建築年月、取得年月日、構造フィールドが正常に動作
- ✅ 耐用年数フィールドが正常に表示

---

## 🎨 UIの特徴

### 構造セレクトボックス

各構造に法定耐用年数を表示：
- RC造（鉄筋コンクリート造）- 耐用47年
- 重量鉄骨造 - 耐用34年
- 軽量鉄骨造（肉厚3mm超3mm超）- 耐用27年
- 軽量鉄骨造（肉厚3mm以下）- 耐用19年
- 木造 - 耐用22年

### リアルタイム計算

建築年月、取得年月日、構造のいずれかを変更すると、即座に耐用年数が自動算定されます。

### シミュレーション作成フォーム

算定結果を青いアラートボックスで表示：
```
算定結果: 耐用年数: 39年 (算定方法: 中古（簡便法）, 経過年数: 10年)
```

---

## 📊 適用範囲

### 物件登録・編集

- ✅ 物件登録フォーム
- ✅ 物件編集フォーム

### シミュレーション

- ✅ シミュレーション作成フォーム（物件ベース/独立シミュレーション）

---

## 🎯 期待される効果

### ユーザーメリット

✅ **手動計算不要**: 耐用年数を自動算定  
✅ **計算ミス防止**: 税法に基づいた正確な計算  
✅ **時間短縮**: 入力と同時に結果が表示  
✅ **中古物件対応**: 簡便法による中古資産の耐用年数算定  
✅ **減価償却費の正確性**: 正しい耐用年数に基づく計算

### システムメリット

✅ **データ品質向上**: 正確な耐用年数データ  
✅ **減価償却費の正確性**: 正しい耐用年数に基づく計算  
✅ **シミュレーション精度向上**: より現実的な収支予測

---

## 📝 計算例

### 例1: 新築RC造マンション

**入力**:
- 建築年月: 2025年12月1日
- 取得年月日: 2026年1月10日
- 構造: RC造

**算定結果**:
- 耐用年数: **47年**
- 算定方法: 新築
- 経過年数: 0年

### 例2: 築10年のRC造マンション

**入力**:
- 建築年月: 2016年1月1日
- 取得年月日: 2026年1月1日
- 構造: RC造

**計算**:
- 経過年数: 10年
- 法定耐用年数: 47年
- (47 - 10) + 10 × 0.2 = 37 + 2 = 39年

**算定結果**:
- 耐用年数: **39年**
- 算定方法: 中古（簡便法）
- 経過年数: 10年

### 例3: 築50年のRC造マンション

**入力**:
- 建築年月: 1976年1月1日
- 取得年月日: 2026年1月1日
- 構造: RC造

**計算**:
- 経過年数: 50年（法定耐用年数47年を超過）
- 法定耐用年数: 47年
- 47 × 0.2 = 9.4年 → 9年

**算定結果**:
- 耐用年数: **9年**
- 算定方法: 中古（簡便法）
- 経過年数: 50年

---

## 🔗 関連情報

- **GitHubコミット**: 85d8ddf
- **本番URL（物件登録）**: https://property-management-app-d46351d49159.herokuapp.com/property/properties/new
- **本番URL（シミュレーション作成）**: https://property-management-app-d46351d49159.herokuapp.com/property/simulations/new

---

## 📚 参考資料

- 国税庁: 減価償却資産の耐用年数等に関する省令
- 国税庁: 中古資産の耐用年数
- 国税庁: 簡便法による中古資産の耐用年数の算定

---

## 🎯 今後の拡張

この機能により、耐用年数の算定が大幅に簡素化されました。今後は以下の機能追加も検討できます：

- **見積法のサポート**: 専門家による残存耐用年数の見積もり
- **用途変更対応**: 用途変更による耐用年数の変更
- **資本的支出対応**: 資本的支出による耐用年数の延長
- **特別償却対応**: 特別償却・割増償却の適用

---

**作成者**: Manus AI  
**最終更新**: 2026年1月3日 23:21 JST
