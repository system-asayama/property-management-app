# 不動産所得・損益シミュレーション機能 設計書

**作成日**: 2026年1月3日  
**バージョン**: 1.0

---

## 1. 概要

不動産管理アプリに、不動産所得や損益のシミュレーション機能を追加します。この機能により、ユーザーは将来の収支予測や投資判断を行うことができます。

---

## 2. 機能要件

### 2.1 シミュレーションの種類

#### 2.1.1 単年度シミュレーション
- 特定の年度における不動産所得と損益を計算
- 収入、経費、減価償却費、所得税・住民税を考慮

#### 2.1.2 複数年度シミュレーション
- 指定した期間（例：5年、10年、20年）の収支推移を計算
- 年度ごとの収入、経費、減価償却費、税金、キャッシュフローを表示
- グラフによる視覚化

#### 2.1.3 物件別シミュレーション
- 特定の物件に対するシミュレーション
- 複数物件の合算シミュレーション

---

## 3. 計算項目

### 3.1 収入項目

| 項目 | 説明 | 計算方法 |
|------|------|----------|
| 家賃収入 | 月額賃料の年間合計 | 月額賃料 × 12ヶ月 × 稼働率 |
| 礼金収入 | 新規契約時の礼金 | 契約時に計上 |
| 更新料収入 | 契約更新時の更新料 | 更新時に計上 |
| その他収入 | 駐車場代、共益費など | ユーザー入力 |

**年間総収入** = 家賃収入 + 礼金収入 + 更新料収入 + その他収入

### 3.2 経費項目

| 項目 | 説明 | 計算方法 |
|------|------|----------|
| 管理費 | 管理会社への委託費用 | 家賃収入 × 管理費率 |
| 修繕費 | 物件の修繕費用 | ユーザー入力または家賃収入の一定割合 |
| 固定資産税 | 固定資産税・都市計画税 | ユーザー入力 |
| 損害保険料 | 火災保険、地震保険など | ユーザー入力 |
| 借入金利息 | ローンの利息部分 | ローン残高 × 金利 |
| 減価償却費 | 建物の減価償却 | 取得価額 × 償却率 |
| その他経費 | 水道光熱費、広告費など | ユーザー入力 |

**年間総経費** = 管理費 + 修繕費 + 固定資産税 + 損害保険料 + 借入金利息 + 減価償却費 + その他経費

### 3.3 不動産所得の計算

```
不動産所得 = 年間総収入 - 年間総経費
```

### 3.4 税金の計算

#### 所得税・住民税
- 不動産所得に対して課税
- 給与所得など他の所得と合算して計算（総合課税）
- 税率は所得金額に応じた累進税率を適用

| 課税所得金額 | 所得税率 | 住民税率 | 合計税率 |
|-------------|---------|---------|---------|
| 195万円以下 | 5% | 10% | 15% |
| 195万円超～330万円以下 | 10% | 10% | 20% |
| 330万円超～695万円以下 | 20% | 10% | 30% |
| 695万円超～900万円以下 | 23% | 10% | 33% |
| 900万円超～1,800万円以下 | 33% | 10% | 43% |
| 1,800万円超～4,000万円以下 | 40% | 10% | 50% |
| 4,000万円超 | 45% | 10% | 55% |

```
税金 = (不動産所得 + その他所得) × 税率 - 控除額
```

### 3.5 キャッシュフロー

```
キャッシュフロー = 年間総収入 - (年間総経費 - 減価償却費) - 税金 - ローン元本返済
```

※減価償却費は実際の現金支出を伴わないため、キャッシュフロー計算では除外

---

## 4. データベース設計

### 4.1 新規テーブル: T_シミュレーション（TSimulation）

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | INTEGER | 主キー |
| tenant_id | INTEGER | テナントID（外部キー） |
| 名称 | VARCHAR(255) | シミュレーション名 |
| 物件id | INTEGER | 物件ID（外部キー、NULL可） |
| 開始年度 | INTEGER | シミュレーション開始年度 |
| 期間 | INTEGER | シミュレーション期間（年） |
| 稼働率 | DECIMAL(5,2) | 稼働率（%） |
| 管理費率 | DECIMAL(5,2) | 管理費率（%） |
| 修繕費率 | DECIMAL(5,2) | 修繕費率（%） |
| 固定資産税 | DECIMAL(15,2) | 年間固定資産税 |
| 損害保険料 | DECIMAL(15,2) | 年間損害保険料 |
| ローン残高 | DECIMAL(15,2) | ローン残高 |
| ローン金利 | DECIMAL(5,2) | ローン金利（%） |
| ローン年間返済額 | DECIMAL(15,2) | 年間返済額 |
| その他収入 | DECIMAL(15,2) | その他年間収入 |
| その他経費 | DECIMAL(15,2) | その他年間経費 |
| その他所得 | DECIMAL(15,2) | 給与所得など他の所得 |
| 税率 | DECIMAL(5,2) | 適用税率（%） |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

### 4.2 新規テーブル: T_シミュレーション結果（TSimulationResult）

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | INTEGER | 主キー |
| シミュレーションid | INTEGER | シミュレーションID（外部キー） |
| 年度 | INTEGER | 年度 |
| 家賃収入 | DECIMAL(15,2) | 家賃収入 |
| その他収入 | DECIMAL(15,2) | その他収入 |
| 総収入 | DECIMAL(15,2) | 総収入 |
| 管理費 | DECIMAL(15,2) | 管理費 |
| 修繕費 | DECIMAL(15,2) | 修繕費 |
| 固定資産税 | DECIMAL(15,2) | 固定資産税 |
| 損害保険料 | DECIMAL(15,2) | 損害保険料 |
| 借入金利息 | DECIMAL(15,2) | 借入金利息 |
| 減価償却費 | DECIMAL(15,2) | 減価償却費 |
| その他経費 | DECIMAL(15,2) | その他経費 |
| 総経費 | DECIMAL(15,2) | 総経費 |
| 不動産所得 | DECIMAL(15,2) | 不動産所得 |
| 税金 | DECIMAL(15,2) | 税金 |
| キャッシュフロー | DECIMAL(15,2) | キャッシュフロー |
| ローン残高 | DECIMAL(15,2) | ローン残高 |
| created_at | TIMESTAMP | 作成日時 |

---

## 5. UI設計

### 5.1 シミュレーション一覧ページ

**URL**: `/property/simulations`

**表示内容**:
- シミュレーション一覧テーブル
  - シミュレーション名
  - 対象物件
  - 期間
  - 作成日
  - アクション（詳細、編集、削除）
- 新規シミュレーション作成ボタン

### 5.2 シミュレーション作成ページ

**URL**: `/property/simulations/new`

**入力項目**:
1. **基本情報**
   - シミュレーション名
   - 対象物件（選択）
   - 開始年度
   - シミュレーション期間（年）

2. **収入設定**
   - 稼働率（%）
   - その他年間収入

3. **経費設定**
   - 管理費率（%）
   - 修繕費率（%）
   - 年間固定資産税
   - 年間損害保険料
   - その他年間経費

4. **ローン設定**
   - ローン残高
   - ローン金利（%）
   - 年間返済額

5. **税金設定**
   - その他所得（給与所得など）
   - 適用税率（自動計算または手動入力）

### 5.3 シミュレーション結果ページ

**URL**: `/property/simulations/<id>`

**表示内容**:
1. **サマリー**
   - シミュレーション名
   - 対象物件
   - 期間

2. **年度別結果テーブル**
   - 年度
   - 総収入
   - 総経費
   - 不動産所得
   - 税金
   - キャッシュフロー
   - ローン残高

3. **グラフ**
   - 収入・経費の推移（折れ線グラフ）
   - キャッシュフローの推移（棒グラフ）
   - 累積キャッシュフローの推移（折れ線グラフ）

4. **詳細内訳**
   - 年度を選択すると、その年度の詳細な収入・経費内訳を表示

---

## 6. 実装方針

### 6.1 フェーズ1: 基本機能
- シミュレーションの作成・保存
- 単年度シミュレーション
- 複数年度シミュレーション
- 結果の表示（テーブル形式）

### 6.2 フェーズ2: 拡張機能
- グラフ表示（Chart.js使用）
- シミュレーションの編集・削除
- 複数物件の合算シミュレーション
- シミュレーション結果のエクスポート（CSV、PDF）

### 6.3 フェーズ3: 高度な機能
- ローン返済シミュレーション（元利均等、元金均等）
- インフレ率の考慮
- 物件売却時のシミュレーション
- 比較機能（複数シミュレーションの比較）

---

## 7. 技術スタック

- **バックエンド**: Flask + SQLAlchemy
- **フロントエンド**: HTML + CSS + JavaScript
- **グラフライブラリ**: Chart.js
- **計算ロジック**: Python（Decimal型を使用して精度を確保）

---

## 8. 注意事項

### 8.1 税金計算の簡略化
- 実際の税金計算は非常に複雑（各種控除、特例など）
- シミュレーションでは簡略化した計算式を使用
- 正確な税額は税理士に相談するよう注意書きを表示

### 8.2 データの精度
- シミュレーション結果はあくまで予測値
- 実際の収支とは異なる可能性があることを明示

### 8.3 セキュリティ
- テナントIDによるデータ分離
- 他のテナントのシミュレーションデータにアクセスできないようにする

---

## 9. 実装スケジュール

| フェーズ | 内容 | 期間 |
|---------|------|------|
| フェーズ1 | データベース設計、基本機能実装 | 1-2時間 |
| フェーズ2 | UI実装、グラフ表示 | 1-2時間 |
| フェーズ3 | テスト、デバッグ、デプロイ | 1時間 |

**合計**: 3-5時間

---

## 10. まとめ

不動産所得・損益シミュレーション機能により、ユーザーは以下のことが可能になります。

1. **将来の収支予測**: 複数年度にわたる収支の推移を把握
2. **投資判断**: 物件購入前のシミュレーションで投資判断をサポート
3. **税金対策**: 減価償却費などを考慮した税金の試算
4. **キャッシュフロー管理**: 実際の現金の流れを把握

この機能により、不動産管理アプリはより実用的で価値の高いツールになります。
