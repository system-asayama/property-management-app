# シミュレーション機能の税金計算式

## 概要

不動産投資シミュレーションにおける税金計算は、日本の所得税法に基づいた累進課税方式を採用しています。不動産所得とその他所得を合算した総所得に対して、所得税と住民税を合わせた税率を適用します。

## 税金計算の流れ

### 1. 課税所得の計算

```
課税所得 = 不動産所得 + その他所得
```

**不動産所得の計算:**
```
不動産所得 = 総収入 - 総経費
```

**総収入の内訳:**
- 家賃収入 = 年間家賃収入 × 稼働率
- その他収入（駐車場収入、礼金、更新料など）

**総経費の内訳:**
- 管理費 = 家賃収入 × 管理費率
- 修繕費 = 家賃収入 × 修繕費率
- 固定資産税
- 損害保険料
- 借入金利息
- 減価償却費
- その他経費

### 2. 税率の決定

税率は、課税所得の金額に応じて以下の累進課税方式で決定されます。

**税率 = 所得税率 + 住民税率（10%）**

| 課税所得金額 | 所得税率 | 住民税率 | 合計税率 |
|------------|---------|---------|---------|
| 195万円以下 | 5% | 10% | **15%** |
| 195万円超～330万円以下 | 10% | 10% | **20%** |
| 330万円超～695万円以下 | 20% | 10% | **30%** |
| 695万円超～900万円以下 | 23% | 10% | **33%** |
| 900万円超～1,800万円以下 | 33% | 10% | **43%** |
| 1,800万円超～4,000万円以下 | 40% | 10% | **50%** |
| 4,000万円超 | 45% | 10% | **55%** |

### 3. 税金の計算

```
税金 = 課税所得 × 税率
```

**マイナス所得の場合:**
```
税金 = 0円（マイナスの場合は0円とする）
```

## 実装コード

### 税率計算関数

```python
def calculate_tax_rate(total_income):
    """所得金額に応じた税率を計算（所得税+住民税）"""
    total_income = Decimal(str(total_income))
    
    if total_income <= 1950000:
        return Decimal('15.0')  # 5% + 10%
    elif total_income <= 3300000:
        return Decimal('20.0')  # 10% + 10%
    elif total_income <= 6950000:
        return Decimal('30.0')  # 20% + 10%
    elif total_income <= 9000000:
        return Decimal('33.0')  # 23% + 10%
    elif total_income <= 18000000:
        return Decimal('43.0')  # 33% + 10%
    elif total_income <= 40000000:
        return Decimal('50.0')  # 40% + 10%
    else:
        return Decimal('55.0')  # 45% + 10%
```

### シミュレーション内の税金計算

```python
# 不動産所得
不動産所得 = 総収入 - 総経費

# 税金計算
if simulation.税率:
    税率 = simulation.税率  # 手動設定された税率を使用
else:
    税率 = calculate_tax_rate(不動産所得 + simulation.その他所得)  # 自動計算

税金 = (不動産所得 + simulation.その他所得) * (税率 / 100)
if 税金 < 0:
    税金 = Decimal('0')
```

## 特徴

### 1. 累進課税方式
- 所得が増えるほど税率が高くなる日本の税制を正確に反映
- 所得税（5%～45%）と住民税（一律10%）を合算

### 2. 柔軟な税率設定
- **自動計算**: 所得金額に応じて税率を自動決定（デフォルト）
- **手動設定**: シミュレーション作成時に税率を手動で設定可能

### 3. その他所得の考慮
- 不動産所得以外の所得（給与所得など）を合算して税率を決定
- より現実的なシミュレーションが可能

### 4. マイナス所得の処理
- 経費が収入を上回る場合（赤字）は税金を0円とする
- 実際の税制では損益通算が可能だが、シミュレーションでは保守的に計算

## キャッシュフロー計算における税金の位置づけ

```
キャッシュフロー = 総収入 - (総経費 - 減価償却費) - 税金 - ローン元本返済
```

**ポイント:**
- 減価償却費は経費として所得計算に含まれるが、実際の現金支出ではないため、キャッシュフロー計算では除外
- 税金は現金支出なので、キャッシュフローから差し引く
- ローン元本返済も現金支出なので、キャッシュフローから差し引く

## 計算例

### 例1: 年間所得500万円の場合

```
課税所得 = 500万円
税率 = 30%（330万円超～695万円以下）
税金 = 500万円 × 30% = 150万円
```

### 例2: 不動産所得300万円 + その他所得500万円の場合

```
課税所得 = 300万円 + 500万円 = 800万円
税率 = 33%（695万円超～900万円以下）
税金 = 800万円 × 33% = 264万円
```

### 例3: 赤字の場合

```
不動産所得 = -100万円（経費が収入を上回る）
その他所得 = 0円
課税所得 = -100万円
税金 = 0円（マイナスの場合は0円）
```

## 注意事項

### 1. 簡易計算である点
- 実際の税金計算では、基礎控除、配偶者控除、社会保険料控除などの各種控除が適用されます
- このシミュレーションでは控除を考慮していないため、実際の税金より高めに計算される可能性があります

### 2. 復興特別所得税は含まれていない
- 実際には所得税額の2.1%が復興特別所得税として加算されます
- より正確な計算が必要な場合は、税率を手動で微調整してください

### 3. 損益通算の簡略化
- 実際の税制では、不動産所得の赤字を他の所得と損益通算できます
- このシミュレーションでは、赤字の場合は税金を0円としています

### 4. 事業税は含まれていない
- 一定規模以上の不動産賃貸業には事業税が課される場合があります
- 必要に応じて「その他経費」に含めてください

## まとめ

このシミュレーションの税金計算は、日本の累進課税制度を基本として、不動産投資の実態に即した現実的な計算を行っています。より詳細な税金計算が必要な場合は、税理士にご相談ください。
