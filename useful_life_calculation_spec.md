# 耐用年数自動算定機能 設計仕様書

**作成日**: 2026年1月3日  
**バージョン**: 1.0

---

## 📋 概要

不動産の**建築年月日**、**取得年月日**、**構造**から、税法に基づいて耐用年数を自動算定する機能を実装します。

---

## 🎯 機能要件

### 入力項目

1. **建築年月日**: 物件の建築された日付
2. **取得年月日**: 物件を取得した日付
3. **構造**: 建物の構造（RC造、重量鉄骨造、軽量鉄骨造、木造）

### 出力項目

1. **建物_耐用年数**: 自動算定された耐用年数（年）
2. **算定方法**: 新築 or 中古（簡便法）

---

## 📐 算定ロジック

### 1. 法定耐用年数（構造別）

| 構造 | 法定耐用年数 |
|------|-------------|
| RC造（鉄筋コンクリート造） | 47年 |
| 重量鉄骨造（骨格材の肉厚4mm超） | 34年 |
| 軽量鉄骨造（骨格材の肉厚3mm超4mm以下） | 27年 |
| 軽量鉄骨造（骨格材の肉厚3mm以下） | 19年 |
| 木造 | 22年 |

### 2. 新築 vs 中古の判定

**新築**: 取得年月日時点で、建築後1年未満かつ未使用の場合

**中古**: 上記以外の場合

**簡易判定**: 建築年月日と取得年月日の差が1年以上の場合は中古とみなす

### 3. 中古資産の耐用年数算定（簡便法）

#### 法定耐用年数の全部を経過している場合

```
耐用年数 = 法定耐用年数 × 0.2
```

#### 法定耐用年数の一部を経過している場合

```
耐用年数 = (法定耐用年数 - 経過年数) + 経過年数 × 0.2
```

**経過年数の計算**:
```
経過年数 = 取得年月日 - 建築年月日（年単位、1年未満切り捨て）
```

**端数処理**: 1年未満の端数は切り捨て、最低2年

---

## 💡 計算例

### 例1: 新築RC造マンション

- 建築年月日: 2025年12月1日
- 取得年月日: 2026年1月10日
- 構造: RC造

**判定**: 新築（建築後1年未満）

**耐用年数**: 47年（法定耐用年数）

### 例2: 築10年のRC造マンション

- 建築年月日: 2016年1月1日
- 取得年月日: 2026年1月1日
- 構造: RC造

**判定**: 中古（建築後10年）

**経過年数**: 10年

**法定耐用年数**: 47年

**計算**: (47 - 10) + 10 × 0.2 = 37 + 2 = 39年

**耐用年数**: 39年

### 例3: 築50年のRC造マンション

- 建築年月日: 1976年1月1日
- 取得年月日: 2026年1月1日
- 構造: RC造

**判定**: 中古（建築後50年、法定耐用年数超過）

**経過年数**: 50年（法定耐用年数47年を超過）

**法定耐用年数**: 47年

**計算**: 47 × 0.2 = 9.4年 → 9年

**耐用年数**: 9年

### 例4: 築25年の木造アパート

- 建築年月日: 2001年1月1日
- 取得年月日: 2026年1月1日
- 構造: 木造

**判定**: 中古（建築後25年、法定耐用年数超過）

**経過年数**: 25年（法定耐用年数22年を超過）

**法定耐用年数**: 22年

**計算**: 22 × 0.2 = 4.4年 → 4年

**耐用年数**: 4年

---

## 🖥️ UI設計

### シミュレーション作成フォーム

#### 入力フィールド

```
建築年月日: [____年__月__日] (date picker)
取得年月日: [____年__月__日] (date picker)
構造: [▼ 選択してください] (select)
  - RC造（鉄筋コンクリート造）
  - 重量鉄骨造
  - 軽量鉄骨造（肉厚3mm超4mm以下）
  - 軽量鉄骨造（肉厚3mm以下）
  - 木造
```

#### 自動計算結果表示

```
建物_耐用年数: [47] 年 (読み取り専用)
算定方法: [新築] (読み取り専用)
```

#### リアルタイム計算

- 建築年月日、取得年月日、構造のいずれかが変更された場合
- JavaScriptで自動的に耐用年数を計算
- 結果をフォームに表示

---

## 🔧 実装方針

### バックエンド（Python）

**ファイル**: `app/utils/useful_life_calculator.py`

**関数**:
- `calculate_useful_life(construction_date, acquisition_date, structure)`
  - 耐用年数を計算して返す
  - 返り値: `(耐用年数, 算定方法)`

### フロントエンド（JavaScript）

**ファイル**: `app/templates/property_simulation_new.html`

**関数**:
- `calculateUsefulLife()`
  - 建築年月日、取得年月日、構造から耐用年数を計算
  - 結果を「建物_耐用年数」フィールドに表示

**イベント**:
- `oninput` / `onchange`: 建築年月日、取得年月日、構造の変更時

---

## 📊 データフロー

```
ユーザー入力
    ↓
建築年月日、取得年月日、構造
    ↓
JavaScript: calculateUsefulLife()
    ↓
├─ 新築 or 中古を判定
├─ 法定耐用年数を取得
├─ 中古の場合は簡便法で計算
└─ 耐用年数を算出
    ↓
建物_耐用年数フィールドに表示
    ↓
フォーム送信
    ↓
データベースに保存
```

---

## 🎯 期待される効果

### ユーザーメリット

✅ **手動計算不要**: 耐用年数を自動算定  
✅ **計算ミス防止**: 税法に基づいた正確な計算  
✅ **時間短縮**: 入力と同時に結果が表示  
✅ **中古物件対応**: 簡便法による中古資産の耐用年数算定

### システムメリット

✅ **データ品質向上**: 正確な耐用年数データ  
✅ **減価償却費の正確性**: 正しい耐用年数に基づく計算  
✅ **シミュレーション精度向上**: より現実的な収支予測

---

## 📝 注意事項

### 簡便法の適用条件

この機能では**簡便法**を使用しています。より正確な耐用年数を算定する場合は、**見積法**（専門家による残存耐用年数の見積もり）を使用してください。

### 法定耐用年数の更新

税法改正により法定耐用年数が変更される可能性があります。その場合は、`useful_life_calculator.py`の`LEGAL_USEFUL_LIFE`辞書を更新してください。

### 特殊なケース

以下のケースは考慮していません：
- 用途変更による耐用年数の変更
- 資本的支出による耐用年数の延長
- 特別償却・割増償却の適用

---

## 🔗 参考資料

- 国税庁: 減価償却資産の耐用年数等に関する省令
- 国税庁: 中古資産の耐用年数
- 国税庁: 簡便法による中古資産の耐用年数の算定

---

**作成者**: Manus AI  
**最終更新**: 2026年1月3日 23:20 JST
