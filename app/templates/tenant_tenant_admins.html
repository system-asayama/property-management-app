{% extends "base.html" %}
{% block title %}管理者一覧{% endblock %}
{% block content %}
<h2>管理者一覧</h2>

<div style="margin-bottom:20px">
  <a class="btn" href="{{ url_for('tenant_admin.tenant_admin_new') }}">新規作成</a>
  <a class="btn sub" href="{{ url_for('tenant_admin.dashboard') }}">戻る</a>
</div>

{% if tenant_admins %}
  {% for ta in tenant_admins %}
  <div class="card" style="padding:20px;border:1px solid #ddd;border-radius:8px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px">
    <div style="display:grid;grid-template-columns:150px 1fr;gap:15px 20px;align-items:start">
      <div style="color:#666;font-weight:500">ID:</div>
      <div>{{ ta.id }}</div>
      
      <div style="color:#666;font-weight:500">ログインID:</div>
      <div><code style="background:#f5f5f5;padding:2px 8px;border-radius:3px;font-size:0.9em">{{ ta.login_id }}</code></div>
      
      <div style="color:#666;font-weight:500">氏名:</div>
      <div style="font-weight:500">{{ ta.name }}</div>
      
      <div style="color:#666;font-weight:500">オーナー:</div>
      <div>
        {% if ta.is_owner == 1 %}
          <span style="color:#ff6f00;font-weight:bold">★ オーナー</span>
        {% else %}
          -
        {% endif %}
      </div>
      
      <div style="color:#666;font-weight:500">管理権限:</div>
      <div>
        {% if ta.is_owner == 1 %}
          <span style="color:#999">（常に有）</span>
        {% elif ta.can_manage_admins == 1 %}
          <span style="color:#2e7d32">✓ 有</span>
        {% else %}
          -
        {% endif %}
      </div>
      
      <div style="color:#666;font-weight:500">有効:</div>
      <div>
        {% if ta.active == 1 %}
          <span style="display:inline-block;padding:4px 16px;background:#d4edda;color:#155724;border-radius:20px;font-size:0.9em;font-weight:500">✓ 有効</span>
        {% else %}
          <span style="display:inline-block;padding:4px 16px;background:#f8f9fa;color:#999;border-radius:20px;font-size:0.9em;font-weight:500">無効</span>
        {% endif %}
      </div>
      
      <div style="color:#666;font-weight:500">作成日時:</div>
      <div>{{ ta.created_at.strftime('%Y-%m-%d %H:%M:%S') if ta.created_at else '-' }}</div>
    </div>
    
    <div style="border-top:1px solid #eee;margin-top:20px;padding-top:15px;display:flex;gap:10px;flex-wrap:wrap">
      {% if ta.id == current_user_id %}
        <span style="color:#999;padding:8px">（自分）</span>
      {% elif is_system_admin or (ta.is_owner != 1) %}
        <a class="btn small" href="{{ url_for('tenant_admin.tenant_admin_edit', tadmin_id=ta.id) }}" style="min-width:80px;text-align:center;background:#fff;color:#6200ea;border:1px solid #6200ea">編集</a>
        
        {% if ta.is_owner != 1 %}
        <form method="post" action="{{ url_for('tenant_admin.toggle_tenant_admin_manage_permission', tadmin_id=ta.id) }}" style="display:inline">
          {% if get_csrf %}<input type="hidden" name="csrf_token" value="{{ get_csrf() }}">{% endif %}
          <button class="btn small" type="submit" style="min-width:100px;background:#757575;border:none">
            {% if ta.can_manage_admins == 1 %}権限剥奪{% else %}権限付与{% endif %}
          </button>
        </form>
        
        <form method="post" action="{{ url_for('tenant_admin.tenant_admin_delete', tadmin_id=ta.id) }}" style="display:inline" onsubmit="return confirm('本当に削除しますか？')">
          {% if get_csrf %}<input type="hidden" name="csrf_token" value="{{ get_csrf() }}">{% endif %}
          <button class="btn small" type="submit" style="min-width:60px;background:#d32f2f;border:none">削除</button>
        </form>
        {% endif %}
      {% else %}
        <span style="color:#999;padding:8px">オーナーは編集のみ可能</span>
      {% endif %}
    </div>
  </div>
  {% endfor %}
{% else %}
<div class="card" style="text-align:center;padding:40px">
  <p style="color:#999">テナント管理者が登録されていません。</p>
  <a class="btn" href="{{ url_for('tenant_admin.tenant_admin_new') }}">最初の管理者を作成</a>
</div>
{% endif %}

{% if get_flashed_messages() %}
<div style="margin-top:20px">
  {% for category, message in get_flashed_messages(with_categories=true) %}
    <div class="alert alert-{{ category }}" style="padding:12px;margin-bottom:8px;border-radius:4px;
         {% if category == 'success' %}background:#d4edda;color:#155724;border:1px solid #c3e6cb{% endif %}
         {% if category == 'error' %}background:#f8d7da;color:#721c24;border:1px solid #f5c6cb{% endif %}">
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
